<%- include('../partials/header') %>

<div class="container">
    <div class="dashboard-header">
        <h1 class="page-title">Admin Dashboard</h1>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid">
        <div class="stat-card stat-primary">
            <div class="stat-value"><%= stats.totalRequests %></div>
            <div class="stat-label">Total Requests</div>
        </div>
        
        <div class="stat-card stat-success">
            <div class="stat-value"><%= stats.totalUsers %></div>
            <div class="stat-label">Total Users</div>
        </div>
        
        
        <div class="stat-card stat-warning">
            <div class="stat-value"><%= stats.requestsToday %></div>
            <div class="stat-label">Requests Today</div>
        </div>
        
        <div class="stat-card stat-info">
            <div class="stat-value">$<%= stats.totalRevenue.toFixed(2) %></div>
            <div class="stat-label">Total Revenue</div>
        </div>
        
        <div class="stat-card stat-danger">
            <div class="stat-value"><%= stats.pendingRequests %></div>
            <div class="stat-label">Pending Review</div>
        </div>
    </div>

    <div class="grid grid-2">
        <!-- Requests by Status -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Requests by Status</h2>
            </div>
            <div class="status-chart">
                <% requestsByStatus.forEach(item => { %>
                    <div class="status-item">
                        <span class="status-label"><%= item.status %></span>
                        <span class="status-count"><%= item.count %></span>
                        <div class="status-bar">
                            <div class="status-fill" style="width: <%= (item.count / stats.totalRequests) * 100 %>%; 
                                background-color: <%= 
                                    item.status === 'approved' ? '#16a34a' :
                                    item.status === 'rejected' ? '#dc2626' :
                                    item.status === 'under_review' ? '#2563eb' : '#d97706'
                                %>">
                            </div>
                        </div>
                    </div>
                <% }) %>
            </div>
        </div>

        <!-- Requests by Department -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Requests by Department</h2>
            </div>
            <div class="department-chart">
                <% requestsByDepartment.forEach(dept => { %>
                    <div class="department-item">
                        <span class="department-label"><%= dept.department_name %></span>
                        <span class="department-count"><%= dept.request_count || 0 %></span>
                    </div>
                <% }) %>
            </div>
        </div>
    </div>

    <!-- Recent Requests -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Recent Requests</h2>
            <a href="/admin/requests" class="btn btn-outline">View All</a>
        </div>
        
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Citizen</th>
                        <th>Service</th>
                        <th>Department</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% recentRequests.forEach(request => { %>
                        <tr>
                            <td>#<%= request.id %></td>
                            <td><%= request.citizen_name %></td>
                            <td><%= request.service_name %></td>
                            <td><%= request.department_name %></td>
                            <td>
                                <span class="status-badge status-<%= request.status %>">
                                    <%= request.status.replace('_', ' ') %>
                                </span>
                            </td>
                            <td><%= new Date(request.submitted_at).toLocaleDateString() %></td>
                            <td>
                                <a href="/officer/request/<%= request.id %>" class="btn btn-secondary">View</a>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Quick Actions</h2>
        </div>
        <div class="quick-actions">
            <a href="/admin/users" class="action-card">
                <div class="action-icon">üë•</div>
                <h3>Manage Users</h3>
                <p>Add, edit, or remove system users</p>
            </a>
            
            <a href="/admin/departments" class="action-card">
                <div class="action-icon">üè¢</div>
                <h3>Manage Departments</h3>
                <p>Configure departments and services</p>
            </a>
            
            <a href="/admin/services" class="action-card">
                <div class="action-icon">üìã</div>
                <h3>Manage Services</h3>
                <p>Add or modify available services</p>
            </a>
            
            <a href="/admin/reports" class="action-card">
                <div class="action-icon">üìä</div>
                <h3>View Reports</h3>
                <p>System analytics and performance</p>
            </a>
        </div>
    </div>
</div>

<style>
    .dashboard-actions {
        display: flex;
        gap: 1rem;
    }
    
    .status-chart, .department-chart {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .status-item, .department-item {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .status-label, .department-label {
        flex: 1;
        font-weight: 500;
    }
    
    .status-count, .department-count {
        font-weight: bold;
        min-width: 3rem;
        text-align: right;
    }
    
    .status-bar {
        flex: 2;
        height: 8px;
        background-color: #e2e8f0;
        border-radius: 4px;
        overflow: hidden;
    }
    
    .status-fill {
        height: 100%;
        transition: width 0.3s ease;
    }
    
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }
    
    .action-card {
        display: block;
        padding: 1.5rem;
        border: 2px solid #e2e8f0;
        border-radius: var(--radius);
        text-decoration: none;
        color: inherit;
        transition: var(--transition);
    }
    
    .action-card:hover {
        border-color: var(--primary);
        transform: translateY(-2px);
    }
    
    .action-icon {
        font-size: 2rem;
        margin-bottom: 1rem;
    }
    
    .action-card h3 {
        margin-bottom: 0.5rem;
        color: var(--dark);
    }
    
    .action-card p {
        color: var(--secondary);
        font-size: 0.875rem;
    }
    
    .stat-info .stat-value {
        color: #8b5cf6;
    }
</style>

<%- include('../partials/footer') %>